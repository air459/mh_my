# 项目概述

这是一个安全的文件删除和恢复工具项目，位于 `/opt/mh_my/rm`。该项目提供了一个自定义的 `rm` 命令，将文件移动到安全位置而不是永久删除，并支持文件恢复功能。

## 目录结构

```
/opt/mh_my/rm/
├── rm.sh          # 主脚本文件（自定义 rm 命令）
├── install.sh     # 安装脚本
├── log/           # 日志目录
├── remove/        # 被删除文件存储目录
├── .rm_record     # 删除记录文件（格式：时间|原文件路径|原文件名称|随机字符串）
└── IFLOW.md       # iFlow 上下文文件
```

## 功能说明

### install.sh - 安装脚本

安装流程：
1. 要求用户输入字符串（用于备份系统 rm 命令）
2. 要求用户再次确认输入相同的字符串
3. 检查是否为 root 用户
4. 将系统 `rm` 命令备份为用户输入的字符串名称
5. 将 `rm.sh` 复制到 `/bin/` 目录并重命名为 `rm`
6. 在 `/bin/rm` 中设置项目路径
7. 设置执行权限

### rm.sh - 主脚本

**初始化功能：**
- 确保项目目录存在（`remove/` 和 `log/`）
- 确保记录文件存在

**删除功能：**
- 将文件移动到项目的 `remove/` 目录中
- 使用 `openssl rand -hex 16` 生成 32 位十六进制随机字符串作为新文件名
- 在 `.rm_record` 文件中记录：时间、原文件路径、原文件名称、随机字符串
- 支持强制删除（`-f`）和递归删除（`-r`）
- 删除目录时需要使用 `-r` 参数

**恢复功能：**
- `rm -m`：恢复所有已删除的文件到原位置，并清空记录文件
- `rm -m file`：读取 `.rm_record`，匹配文件名或随机字符串，恢复指定文件
- `rm -m file 路径`：恢复文件到指定路径
- 恢复后从记录文件中移除对应记录

**查看功能：**
- `rm -l`：显示已删除的文件列表，包括时间、原路径、文件名和恢复ID

**帮助功能：**
- `rm -h` 或 `rm --help`：显示帮助信息

## 使用方法

**注意：** 以下所说的"删除"都是把文件移动到本项目 `remove/` 目录中

### 基本用法

```bash
# 删除文件
rm [选项] [文件...]

# 删除单个文件
rm file

# 强制删除文件
rm -f file

# 递归删除目录
rm -r directory

# 强制递归删除
rm -rf directory

# 删除多个文件
rm file1 file2 file3
```

### 恢复功能

```bash
# 恢复所有已删除的文件
rm -m

# 恢复指定文件（通过文件名）
rm -m main.cpp

# 恢复指定文件（通过恢复ID）
rm -m a3e9d13c066e27b3381056d2d0227cfb

# 恢复文件到指定路径
rm -m main.cpp /home/user/new_location
```

### 查看功能

```bash
# 显示已删除的文件列表
rm -l
```

### 帮助信息

```bash
# 显示帮助信息
rm -h
rm --help
```

## 记录文件格式

`.rm_record` 文件格式（使用 `|` 分隔符）：
```
时间|原文件路径|原文件名称|随机字符串
```

示例：
```
2026-01-03 05:28:27|/home/Air/main|main|a3e9d13c066e27b3381056d2d0227cfb
2026-01-03 05:28:27|/home/Air/main.cpp|main.cpp|649da254ba26dbdc0f23a2962a39e845
```

## 项目状态

- ✅ `rm.sh` - 主脚本文件（已实现）
- ✅ `install.sh` - 安装脚本（已实现）
- ✅ `log/` - 日志目录（已创建）
- ✅ `remove/` - 被删除文件存储目录（已创建，包含已删除文件）
- ✅ `.rm_record` - 删除记录文件（已创建，包含删除记录）

## 技术细节

### 随机字符串生成
使用 `openssl rand -hex 16` 生成 32 位十六进制随机字符串，确保文件名唯一且难以猜测。

### 文件恢复机制
- 恢复时会自动创建目标目录（如果不存在）
- 恢复指定文件后，会从记录文件中移除对应记录
- 恢复所有文件后，会清空整个记录文件

### 错误处理
- 删除不存在的文件会显示错误信息
- 删除目录时未使用 `-r` 参数会提示错误
- 恢复不存在的文件会显示未找到提示
